function nmap_extend(t,e){var a={};for(var r in t)a[r]=t[r];for(r in e)a[r]=e[r];return a}var nmap_element=function(t){function e(){}var a={id:1,klass:1,weight:1,x:0,y:0},r=nmap_extend(a,t);return e.attr=function(){return r},e.getX=function(){return parseFloat(r.x)},e.setX=function(t){r.x=t},e.getY=function(){return parseFloat(r.y)},e.setY=function(t){r.y=t},e.getId=function(){return r.id},e.setId=function(t){r.id=t},e.getKlass=function(){return parseFloat(r.klass)},e.setKlass=function(t){r.klass=t},e.getWeight=function(){return parseFloat(r.weight)},e.setWeight=function(t){r.weight=t},e},nmap_boundingbox=function(t){function e(){}var a={x:0,y:0,width:0,height:0,element:null},r=nmap_extend(a,t);return e.attr=function(){return r},e.setBounds=function(t){r=nmap_extend(r,t)},e.getElement=function(){return r.element},e.setElement=function(t){r.element=t},e},nmap=function(t){function e(){null===r.visualSpace&&(r.visualSpace=new nmap_boundingbox({x:r.x,y:r.y,height:r.height,width:r.width}))}var a={x:0,y:0,width:1,height:1,visualSpace:null,HORIZONTAL:!0,VERTICAL:!1},r=nmap_extend(a,t);return e(),e.attr=function(){return r},e.normalize=function(t){if(null!==t){for(var e=Number.MIN_VALUE,a=Number.MAX_VALUE,i=Number.MIN_VALUE,n=Number.MAX_VALUE,h=0;h<t.length;h++)e=Math.max(e,t[h].getX()),a=Math.min(a,t[h].getX()),i=Math.max(i,t[h].getY()),n=Math.min(n,t[h].getY());for(h=0;h<t.length;h++)t[h].setX((t[h].getX()-a)/(e-a)*r.visualSpace.attr().width+r.visualSpace.attr().x),t[h].setY((t[h].getY()-n)/(i-n)*r.visualSpace.attr().height+r.visualSpace.attr().y)}return t},e.sortByX=function(t,e){return t.getX()<e.getX()?-1:t.getX()>e.getX()?1:0},e.sortByY=function(t,e){return t.getY()<e.getY()?-1:t.getY()>e.getY()?1:0},e.alternateCut=function(t){var a={elements:null,visualSpace:r.visualSpace,bisection:null};if(t=nmap_extend(a,t),t.elements=e.normalize(t.elements),null===t.bisection){var i;t.visualSpace.attr().width>t.visualSpace.attr().height?t.bisection=r.HORIZONTAL:t.bisection=r.VERTICAL}var n=[];if(1===t.elements.length){var h=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width,height:t.visualSpace.attr().height,element:t.elements[0]});n.push(h)}else{t.bisection===r.HORIZONTAL?t.elements.sort(e.sortByX):t.elements.sort(e.sortByY);for(var s=Math.floor(t.elements.length/2),l=t.elements.slice(0,s),g=t.elements.slice(s,t.elements.length),u=0,o=0;o<l.length;o++)u+=l[o].getWeight();var c=0;for(o=0;o<g.length;o++)c+=g[o].getWeight();var p=null,v=null,d,m;if(t.bisection===r.HORIZONTAL){var x=u/(u+c)*t.visualSpace.attr().width,f=c/(u+c)*t.visualSpace.attr().width,w=(l[l.length-1].getX()+g[0].getX())/2;p=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:w-t.visualSpace.attr().x,height:t.visualSpace.attr().height}),v=new nmap_boundingbox({x:t.visualSpace.attr().x+p.attr().width,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width-p.attr().width,height:t.visualSpace.attr().height});var y=new goog.graphics.AffineTransform(x/p.attr().width,0,0,1,t.visualSpace.attr().x*(1-x/p.attr().width),0);for(o=0;o<l.length;o++)d=[l[o].getX(),l[o].getY()],m=[],y.transform(d,0,m,0,1),l[o].setX(m[0]),l[o].setY(m[1]);d=[p.attr().x,p.attr().y,p.attr().x,p.attr().y+p.attr().height,p.attr().x+p.attr().width,p.attr().y+p.attr().height,p.attr().x+p.attr().width,p.attr().y],m=[],y.transform(d,0,m,0,4),p.setBounds({x:m[0],y:m[1],width:m[4]-m[0],height:m[5]-m[1]});var S=new goog.graphics.AffineTransform(f/v.attr().width,0,0,1,(t.visualSpace.attr().x+t.visualSpace.attr().width)*(1-f/v.attr().width),0);for(o=0;o<g.length;o++)d=[g[o].getX(),g[o].getY()],m=[],S.transform(d,0,m,0,1);d=[v.attr().x,v.attr().y,v.attr().x,v.attr().y+v.attr().height,v.attr().x+v.attr().width,v.attr().y+v.attr().height,v.attr().x+v.attr().width,v.attr().y],m=[],S.transform(d,0,m,0,4),v.setBounds({x:m[0],y:m[1],width:m[4]-m[0],height:m[5]-m[1]})}else if(t.bisection===r.VERTICAL){var b=u/(u+c)*t.visualSpace.attr().height,X=c/(u+c)*t.visualSpace.attr().height,Y=(l[l.length-1].getY()+g[0].getY())/2;p=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width,height:Y-t.visualSpace.attr().y}),v=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y+p.attr().height,width:t.visualSpace.attr().width,height:t.visualSpace.attr().height-p.attr().height});var A=new goog.graphics.AffineTransform(1,0,0,b/p.attr().height,0,t.visualSpace.attr().y*(1-b/p.attr().height));for(o=0;o<l.length;o++)d=[l[o].getX(),l[o].getY()],m=[],A.transform(d,0,m,0,1),l[o].setX(m[0]),l[o].setY(m[1]);d=[p.attr().x,p.attr().y,p.attr().x,p.attr().y+p.attr().height,p.attr().x+p.attr().width,p.attr().y+p.attr().height,p.attr().x+p.attr().width,p.attr().y],m=[],A.transform(d,0,m,0,4),p.setBounds({x:m[0],y:m[1],width:m[4]-m[0],height:m[5]-m[1]});var _=new goog.graphics.AffineTransform(1,0,0,X/v.attr().height,0,(t.visualSpace.attr().y+t.visualSpace.attr().height)*(1-X/v.attr().height));for(o=0;o<g.length;o++)d=[g[o].getX(),g[o].getY()],m=[],_.transform(d,0,m,0,1);d=[v.attr().x,v.attr().y,v.attr().x,v.attr().y+v.attr().height,v.attr().x+v.attr().width,v.attr().y+v.attr().height,v.attr().x+v.attr().width,v.attr().y],m=[],_.transform(d,0,m,0,4),v.setBounds({x:m[0],y:m[1],width:m[4]-m[0],height:m[5]-m[1]})}n=n.concat(e.alternateCut({visualSpace:p,elements:l,bisection:!t.bisection})),n=n.concat(e.alternateCut({visualSpace:v,elements:g,bisection:!t.bisection}))}return n},e.equalWeight=function(t){var a={elements:null,visualSpace:r.visualSpace,bisection:r.VERTICAL};t=nmap_extend(a,t),t.elements=e.normalize(t.elements);var i=[];if(1===t.elements.length){var n=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width,height:t.visualSpace.attr().height,element:t.elements[0]});i.push(n)}else{t.visualSpace.attr().width>t.visualSpace.attr().height&&(t.bisection=r.HORIZONTAL),t.bisection===r.HORIZONTAL?t.elements.sort(e.sortByX):t.elements.sort(e.sortByY);for(var h=0,s=0,l=0,g=0,u=1,o=0;o<t.elements.length;o++)g+=t.elements[o].getWeight();var c=Number.MAX_VALUE;for(o=1;o<t.elements.length;++o)l+=t.elements[o-1].getWeight(),g-=t.elements[o-1].getWeight(),Math.abs(l-g)<c&&(c=Math.abs(l-g),u=o,h=l,s=g);var p=t.elements.slice(0,u),v=t.elements.slice(u,t.elements.length),d=null,m=null,x=[],f=[];if(t.bisection===r.HORIZONTAL){var w=h/(h+s)*t.visualSpace.attr().width,y=s/(h+s)*t.visualSpace.attr().width,S=(p[p.length-1].getX()+v[0].getX())/2;d=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:S-t.visualSpace.attr().x,height:t.visualSpace.attr().height}),m=new nmap_boundingbox({x:t.visualSpace.attr().x+d.attr().width,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width-d.attr().width,height:t.visualSpace.attr().height});var b=new goog.graphics.AffineTransform(w/d.attr().width,0,0,1,t.visualSpace.attr().x*(1-w/d.attr().width),0);for(o=0;o<p.length;o++)x=[p[o].getX(),p[o].getY()],f=[],b.transform(x,0,f,0,1),p[o].setX(f[0]),p[o].setY(f[1]);x=[d.attr().x,d.attr().y,d.attr().x,d.attr().y+d.attr().height,d.attr().x+d.attr().width,d.attr().y+d.attr().height,d.attr().x+d.attr().width,d.attr().y],f=[],b.transform(x,0,f,0,4),d.setBounds({x:f[0],y:f[1],width:f[4]-f[0],height:f[5]-f[1]});var X=new goog.graphics.AffineTransform(y/m.attr().width,0,0,1,(t.visualSpace.attr().x+t.visualSpace.attr().width)*(1-y/m.attr().width),0);for(o=0;o<v.length;o++)x=[v[o].getX(),v[o].getY()],f=[],X.transform(x,0,f,0,1);x=[m.attr().x,m.attr().y,m.attr().x,m.attr().y+m.attr().height,m.attr().x+m.attr().width,m.attr().y+m.attr().height,m.attr().x+m.attr().width,m.attr().y],f=[],X.transform(x,0,f,0,4),m.setBounds({x:f[0],y:f[1],width:f[4]-f[0],height:f[5]-f[1]})}else if(t.bisection===r.VERTICAL){var Y=h/(h+s)*t.visualSpace.attr().height,A=s/(h+s)*t.visualSpace.attr().height,_=(p[p.length-1].getY()+v[0].getY())/2;d=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y,width:t.visualSpace.attr().width,height:_-t.visualSpace.attr().y}),m=new nmap_boundingbox({x:t.visualSpace.attr().x,y:t.visualSpace.attr().y+d.attr().height,width:t.visualSpace.attr().width,height:t.visualSpace.attr().height-d.attr().height});var T=new goog.graphics.AffineTransform(1,0,0,Y/d.attr().height,0,t.visualSpace.attr().y*(1-Y/d.attr().height));for(o=0;o<p.length;o++)x=[p[o].getX(),p[o].getY()],f=[],T.transform(x,0,f,0,1),p[o].setX(f[0]),p[o].setY(f[1]);x=[d.attr().x,d.attr().y,d.attr().x,d.attr().y+d.attr().height,d.attr().x+d.attr().width,d.attr().y+d.attr().height,d.attr().x+d.attr().width,d.attr().y],f=[],T.transform(x,0,f,0,4),d.setBounds({x:f[0],y:f[1],width:f[4]-f[0],height:f[5]-f[1]});var L=new goog.graphics.AffineTransform(1,0,0,A/m.attr().height,0,(t.visualSpace.attr().y+t.visualSpace.attr().height)*(1-A/m.attr().height));for(o=0;o<v.length;o++)x=[v[o].getX(),v[o].getY()],f=[],L.transform(x,0,f,0,1);x=[m.attr().x,m.attr().y,m.attr().x,m.attr().y+m.attr().height,m.attr().x+m.attr().width,m.attr().y+m.attr().height,m.attr().x+m.attr().width,m.attr().y],f=[],L.transform(x,0,f,0,4),m.setBounds({x:f[0],y:f[1],width:f[4]-f[0],height:f[5]-f[1]})}i=i.concat(e.equalWeight({visualSpace:d,elements:p})),i=i.concat(e.equalWeight({visualSpace:m,elements:v}))}return i},e};